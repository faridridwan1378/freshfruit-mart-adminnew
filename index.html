<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin - Varsha Fruits & Goods</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.css" rel="stylesheet">
  <style>
    body { background: #111; color: #fff; font-family: 'Segoe UI', sans-serif; }
    .card { background: #222; border: 1px solid #444; }
    .btn-success { background: #16a34a; border: none; }
    .btn-warning { background: #f59e0b; border: none; }
    .btn-danger { background: #dc2626; border: none; }
    .btn-info { background: #0d9488; border: none; }
    .btn-secondary { background: #64748b; border: none; }
  </style>
</head>
<body>

<div class="container py-5">
  <div class="text-center mb-5">
    <h1 class="display-5 fw-bold text-success mb-3">ADMIN PANEL</h1>
    <h2 class="text-warning">Varsha Fruits & Goods</h2>
    <p class="text-muted">Backup, Restore & Kelola Produk</p>
  </div>

  <!-- TOMBOL UTAMA -->
  <div class="row g-3 mb-5">
    <div class="col-md-4">
      <button class="btn btn-success btn-lg w-100 py-3 fw-bold" data-bs-toggle="modal" data-bs-target="#modalProduk">
        + Tambah Produk
      </button>
    </div>
    <div class="col-md-4">
      <button onclick="backupData()" class="btn btn-info btn-lg w-100 py-3 fw-bold text-white">
        BACKUP DATA (.json)
      </button>
    </div>
    <div class="col-md-4">
      <button onclick="document.getElementById('restoreFile').click()" class="btn btn-secondary btn-lg w-100 py-3 fw-bold text-white">
        RESTORE DARI FILE
      </button>
      <input type="file" id="restoreFile" accept=".json" style="display:none;" onchange="restoreData(event)">
    </div>
  </div>

  <div class="text-center mb-4">
    <button onclick="hapusSemuaData()" class="btn btn-danger btn-lg px-5 py-3 fw-bold">
      HAPUS SEMUA PRODUK
    </button>
  </div>

  <hr class="border-secondary">

  <h4 class="text-center text-success mb-4">Daftar Produk</h4>
  <div id="daftarProduk"></div>
</div>

<!-- Modal Tambah/Edit -->
<div class="modal fade" id="modalProduk">
  <div class="modal-dialog modal-lg">
    <div class="modal-content bg-dark text-white">
      <div class="modal-header border-warning">
        <h5 class="modal-title" id="judulModal">Tambah Produk</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form id="formProduk">
          <input type="hidden" id="editId">
          <div class="row">
            <div class="col-md-7">
              <input type="text" id="namaProduk" class="form-control mb-3 bg-secondary text-white" placeholder="Nama Produk" required>
              <div class="row">
                <div class="col-6"><input type="number" id="hargaProduk" class="form-control mb-3 bg-secondary text-white" placeholder="Harga (Rp)" required></div>
                <div class="col-6"><input type="number" id="stokProduk" class="form-control mb-3 bg-secondary text-white" placeholder="Stok" required></div>
              </div>
              <select id="satuanProduk" class="form-select mb-3 bg-secondary text-white">
                <option value="kg">kg</option>
                <option value="sisir">sisir</option>
                <option value="buah">buah</option>
                <option value="pack">pack</option>
              </select>
            </div>
            <div class="col-md-5">
              <input type="file" id="inputFoto" accept="image/*" class="form-control mb-3 bg-secondary text-white">
              <div class="text-center">
                <img id="previewFoto" src="" class="img-fluid rounded shadow" style="max-height:280px; display:none;">
              </div>
            </div>
          </div>
          <div class="text-center mt-4">
            <button type="submit" class="btn btn-success btn-lg px-5">SIMPAN PRODUK</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<script src="data.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.js"></script>
<script>
// PASSWORD ADMIN
if (prompt("üîê Password Admin:") !== "farid123") {
  alert("Password salah!");
  window.location.href = "index.html";
}

let cropper;

// Render produk
function renderProduk() {
  const el = document.getElementById('daftarProduk');
  el.innerHTML = produk.length === 0 
    ? '<p class="text-center text-muted fs-4">Belum ada produk</p>'
    : produk.map(p => `
      <div class="card mb-3">
        <div class="row g-0">
          <div class="col-4">
            <img src="${p.foto}" class="img-fluid rounded-start" style="height:160px; object-fit:cover;">
          </div>
          <div class="col-8">
            <div class="card-body">
              <h5 class="text-success">${p.nama}</h5>
              <p>Rp ${p.harga.toLocaleString()} / ${p.satuan} ‚Ä¢ Stok: <strong>${p.stok}</strong></p>
              <button class="btn btn-warning btn-sm me-2" onclick="editProduk(${p.id})">Edit</button>
              <button class="btn btn-danger btn-sm" onclick="hapusProduk(${p.id})">Hapus</button>
            </div>
          </div>
        </div>
      </div>
    `).join('');
}

// Backup Data
function backupData() {
  const data = JSON.stringify(produk, null, 2);
  const blob = new Blob([data], {type: 'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `backup_freshfruit_${new Date().toISOString().slice(0,10)}.json`;
  a.click();
  alert("Backup berhasil di-download!");
}

// Restore Data
function restoreData(event) {
  const file = event.target.files[0];
  if (!file) return;
  
  const reader = new FileReader();
  reader.onload = function(e) {
    try {
      const data = JSON.parse(e.target.result);
      if (Array.isArray(data)) {
        produk = data;
        simpanProduk();
        renderProduk();
        alert("Data berhasil direstore!");
      } else {
        alert("File tidak valid!");
      }
    } catch (err) {
      alert("Error: File rusak atau bukan backup!");
    }
  };
  reader.readAsText(file);
}

// Hapus Semua
function hapusSemuaData() {
  if (confirm("‚ö†Ô∏è YAKIN HAPUS SEMUA PRODUK?\nTindakan ini tidak bisa dibatalkan!")) {
    if (confirm("KONFIRMASI LAGI: Semua produk akan hilang permanen!")) {
      produk = [];
      simpanProduk();
      renderProduk();
      alert("Semua produk telah dihapus!");
    }
  }
}

// Edit & Simpan (sama seperti sebelumnya)
function editProduk(id) {
  const p = produk.find(x => x.id === id);
  document.getElementById('judulModal').textContent = "Edit Produk";
  document.getElementById('editId').value = id;
  document.getElementById('namaProduk').value = p.nama;
  document.getElementById('hargaProduk').value = p.harga;
  document.getElementById('stokProduk').value = p.stok;
  document.getElementById('satuanProduk').value = p.satuan;
  document.getElementById('previewFoto').src = p.foto;
  document.getElementById('previewFoto').style.display = 'block';
  new bootstrap.Modal(document.getElementById('modalProduk')).show();
}

document.getElementById('inputFoto').addEventListener('change', e => {
  if (e.target.files[0]) {
    const reader = new FileReader();
    reader.onload = ev => {
      const img = document.getElementById('previewFoto');
      img.src = ev.target.result;
      img.style.display = 'block';
      if (cropper) cropper.destroy();
      cropper = new Cropper(img, {aspectRatio: 1, viewMode: 2});
    };
    reader.readAsDataURL(e.target.files[0]);
  }
});

document.getElementById('formProduk').addEventListener('submit', e => {
  e.preventDefault();
  const id = document.getElementById('editId').value || Date.now();
  const foto = cropper 
    ? cropper.getCroppedCanvas({width:800,height:800}).toDataURL('image/jpeg', 0.9)
    : document.getElementById('previewFoto').src;

  const data = {
    id: parseInt(id),
    nama: document.getElementById('namaProduk').value,
    harga: parseInt(document.getElementById('hargaProduk').value),
    satuan: document.getElementById('satuanProduk').value,
    stok: parseInt(document.getElementById('stokProduk').value),
    foto
  };

  if (document.getElementById('editId').value) {
    produk = produk.map(p => p.id === data.id ? data : p);
  } else {
    produk.push(data);
  }
  simpanProduk();
  renderProduk();
  bootstrap.Modal.getInstance(document.getElementById('modalProduk')).hide();
  alert("Produk berhasil disimpan!");
});

// Reset modal
document.querySelector('[data-bs-target="#modalProduk"]').onclick = () => {
  document.getElementById('formProduk').reset();
  document.getElementById('editId').value = '';
  document.getElementById('judulModal').textContent = "Tambah Produk Baru";
  document.getElementById('previewFoto').style.display = 'none';
  if (cropper) cropper.destroy();
};

// Init
renderProduk();
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
